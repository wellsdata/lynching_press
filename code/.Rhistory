#sample code: ssampcalc(df, n, strata, over=0)
x <- ssampcalc(index, n=60042, strata=year, over=0.5)
x <- janitor::clean_names(x)
x
#Fact check
#sum(x$nh)
#nh is the total pages per year
#wt[,1] is the percentage of the total corpus (60042 pages)
#Shows peak media coverage of lynching activity between 1893-1910
#Peak year for coverage was 1903, with 2971 pages and 4.94% of all pages
tolnay_beck <- read_csv("https://osf.io/download/vb8wa/?view_only=6c106acd6cb54f6f849e8c6f9098809f") %>%
as.data.frame()
tolnay_beck <- janitor::clean_names(tolnay_beck)
# This contains
# tolnay_beck	5871 confirmed and probable
tolnay_beck %>%
count(status)
tolnay_beck <- tolnay_beck %>%
mutate(
status_clean = str_to_lower(status))
tolnay_beck$status_clean <- stringr::str_trim(tolnay_beck$status_clean)
tolnay_beck %>%
count(status_clean)
tolnay_beck <- tolnay_beck %>%
mutate(
status_clean = case_when(
status_clean == 'coincident death' ~ 'coincidental death',
status_clean == 'possiible lynching' ~ 'possible lynching',
TRUE ~ status_clean
))
install.packages('htmlTable')
library(htmlTable)
tolnay_counts <- tolnay_beck %>%
count(status_clean) %>%
rename(Total = n, Type = status_clean) %>%
mutate(Percent_Total = round(Total/5871, 3)) %>%
mutate(Percent_Total = formattable::percent(Percent_Total)) %>%
arrange(desc(Total))
#install.packages("rempsyc")
library(rempsyc)
nice_table(tolnay_counts, short = TRUE)
library(kableExtra)
kbl(tolnay_counts) %>%
kable_paper(full_width = F) %>%
column_spec(1, bold = T, border_right = T) %>%
column_spec(2, width = "5em", background = "yellow")
tolnay_counts %>%
# arrange(desc(n)) %>%
#kbl(caption = "Lynching Totals", font_size = 30) %>%
kbl(caption = "Lynching by type, Tolnay, Beck & Bailey list of 5,872 cases, 1865-2020", font_size = 24) %>%
kable_classic(full_width = F, html_font = "Cambria") %>%
column_spec(1, bold = T, border_right = T) %>%
column_spec(2, width = "5em", background = "yellow")
#Tolnay Beck Lynch Totals 4_14_2023.png
install.packages("htmlTable")
tolnay_events <- tolnay_beck %>%
select(year, status_clean) %>%
group_by(year) %>%
count(status_clean)
tolnay_events %>%
pivot_wider(names_from = status_clean, values_from = n)
tolnay_beck %>%
count(year) %>%
group_by(year) %>%
#Sandwich it onto a simple ggplot
ggplot(aes(x = year, y = n, fill = n)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
labs(title = "Actual, Threatened Lynchings, 1865-2020",
subtitle = "Count of Actual, Probable Lynchings. Tolnay-Beck Data",
caption = "n=5,871 incidents (lynchings = 5,039. Graphic by (redacted - peer review), 4/14/2023",
y="Count",
x="Year")
#Actual, Threatened Lynchings Tolnay 4_14_2023
tolnay_beck %>%
select(year, status_clean) %>%
group_by(year) %>%
count(status_clean) %>%
#Sandwich it onto a simple ggplot
ggplot(aes(x = year, y = n, fill = n)) +
geom_col(position = "dodge") +
labs(title = "Actual, Threatened Lynchings, 1865-2020",
subtitle = "Count of Actual, Probable Lynchings. Tolnay-Beck Data",
caption = "n=5,871 incidents (lynchings = 5,039. Graphic by (redacted - peer review), 4/14/2023",
y="Count",
x="Year")
tolnay_beck_year <- tolnay_beck %>%
group_by(year) %>%
count(year) %>%
rename(total = n) %>%
mutate(pct_total = formattable::percent(total/5871, 3))
tolnay_beck_year
lynching_year <- index2 %>%
group_by(year) %>%
count(year) %>%
rename(total = n) %>%
mutate(pct_total = formattable::percent(total/11223, 3))
lynching_year
#Determine sample size by strata using proportional allocation
#ssampcalc(df, n, strata, over=0)
xx <- ssampcalc(tolnay_beck, n=5871, strata=year, over=0.5)
xx
combo2 <- lynching_year %>%
right_join(tolnay_beck_year, by="year") %>%
filter(year <="1963")
combo2 <- combo2 %>%
rename(news_total = total.x, news_pct = pct_total.x, lynch_total = total.y, lynch_pct = pct_total.y)
pl <- ggplot(data = combo2, aes(x = year))
pl <- pl + geom_line(aes(y=lynch_pct), colour = "blue")
pl <- pl + geom_line(aes(y=news_pct), colour = "red")
pl <- pl + scale_y_continuous(labels = scales::percent)
pl <- pl + scale_x_continuous(breaks=c(1860, 1865, 1870, 1875, 1880, 1885, 1890, 1895, 1900, 1905, 1910, 1915, 1920, 1925, 1930, 1935, 1940, 1945, 1950, 1955, 1960))
pl <- pl + theme(axis.text.x = element_text(angle=90))
pl <- pl + labs(x = "Year", y = "Pct of whole")
pl <- pl + labs(title = "Media Coverage vs Lynchings, 1865-1963",
subtitle = "Media Coverage (Red) vs. Actual Victims (Blue), pct of whole",
caption = "Tolnay_Beck Victims n = 5871. Media n = 11,223 articles. Graphic by (redacted - peer review), 6/25/2024")
pl
View(combo2)
View(lynching_year)
sum(lynching_year$total)
sum(lynching_year$pct_total)
ggsave("../output_images_tables/Figure_5_ida_graph_6_25_2024.png", device = "png",width=9,height=6, dpi=800)
#focus on the change in 1890 - 1920
combo3 <- combo2 %>%
filter(year >= "1890" & year <= "1920") %>%
select(year, news_pct, lynch_pct)
plx <- ggplot(data = combo3, aes(x = year))
plx <- plx + geom_line(aes(y=lynch_pct), colour = "blue")
plx <- plx + geom_line(aes(y=news_pct), colour = "red")
plx <- plx + scale_x_continuous(breaks=c(1890:1920))
plx <- plx + scale_y_continuous(labels = scales::percent)
plx <- plx + theme(axis.text.x = element_text(angle=90))
plx <- plx + labs(x = "Year", y = "Pct of whole")
plx <- plx + labs(title = "Media Coverage vs Lynchings, 1890-1920",
subtitle = "Media Coverage (Red) vs. Actual Victims (Blue), pct of whole",
caption = "Tolnay_Beck Victims n = 5871. Media n = 11,223 pages. Graphic by (redacted - peer review), 6/25/2024")
ggsave("../output_images_tables/Figure_6_detail_ida_graph_6_25_2024.png", device = "png",width=9,height=6, dpi=800)
plx
ggsave("../output_images_tables/Figure_6_detail_ida_graph_6_25_2024.png", device = "png",width=9,height=6, dpi=800)
View(x)
sum(x$wt[, 1])
names(x)
sum(x$wt)
sum(x$nh)
1101/60042
df <- combo3 %>%
pivot_longer(!year, names_to = "type", values_to = "weight")
ggplot(df, aes(x=year, y=weight, fill=type)) +
geom_bar(stat='identity', position='dodge') +
scale_x_continuous(labels = c(seq(1890, 1930, 5)), breaks = seq(1890, 1930, 5)) +
labs(title = "Media Coverage Exceeds Actual Lynchings After 1897",
subtitle = "Weighted Samples: Media Coverage (Red) vs. Actual Victims (Blue)",
caption = "tolnay_beck Victims n = 5871. Media n = 11223 articles. Graphic by (redacted - peer review), 6/25/2024")
#ggsave(here::here("../hcij_lynching_phase_two/narratives/output_images_tables/media_lynching_2.png"),device = "png",width=9,height=6, dpi=800)
lynch1 <- extracted_text_june_22_2024 %>%
filter(black_press != "Y" | is.na(black_press))
extracted_text_june_22_2024 <- read_csv("https://osf.io/download/p32he/?view_only=6c106acd6cb54f6f849e8c6f9098809f")
lynch1 <- extracted_text_june_22_2024 %>%
filter(black_press != "Y" | is.na(black_press))
white_lynch <- extracted_text_june_22_2024 %>%
filter(black_press != "Y" | is.na(black_press))
onlybptext <- extracted_text_june_22_2024 %>%
filter(black_press == "Y")
y <- lynch2 %>%
select(filename, sentence, words, year, newspaper_name, url)
y <- index2 %>%
select(filename, sentence, words, year, newspaper_name, url)
names(index2)
xxx <- stringi::stri_count_words(extracted_text_june_22_2024$sentence, "\\w+") %>%
as.data.frame() %>%
rename(words = ".")
#
lynch <- cbind(extracted_text_june_22_2024, xxx)
y <- lynch %>%
select(file_id, sentence, words, year, newspaper_name, url)
#
# # append decade information for aggregation
y$decade <- paste0(substr(y$year, 0, 3), "0")
z <- y %>%
select(file_id, newspaper_name, url, words, decade) %>%
group_by(filename, decade) %>%
summarize(total=sum(words))
z <- y %>%
select(file_id, newspaper_name, url, words, decade) %>%
group_by(file_id, decade) %>%
summarize(total=sum(words))
View(z)
lynch_word_decade <- z %>%
select(decade, total) %>%
group_by(decade) %>%
summarize(avg_words=mean(total, na.rm=TRUE)) %>%
mutate(avg_words = round(avg_words, 0)) %>%
filter(!decade>1960)
View(lynch_word_decade)
lynch_word_decade <- z %>%
select(decade, total) %>%
group_by(decade) %>%
summarise(
avg_words = mean(total, na.rm = TRUE),
num_articles = n()
) %>%
mutate(avg_words = round(avg_words, 0)) %>%
filter(!decade>1960)
lynch_word_decade %>%
ggplot(aes(x = decade, y = avg_words,fill = avg_words)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
labs(title = "Average Word Count in Lynching News Coverage",
subtitle = "Based in 11,223 extracted articles, 1805-1963",
caption = "Graphic by (redacted - peer review), 6-25-2024",
y="Average Article Word Count",
x="Decade")
ggsave("../output_images_tables/Article_Images/Figure7_avg_word_count_june_25_2024.png",device = "png",width=9,height=6, dpi=800)
View(index2)
pageplacement <- index2 %>%
count(page) %>%
group_by(page, decade) %>%
ungroup()
index2$decade <- paste0(substr(index2$year, 0, 3), "0")
pageplacement <- index2 %>%
count(page) %>%
group_by(page, decade) %>%
ungroup()
index2$decade <- paste0(substr(index2$year, 0, 3), "0")
pageplacement <- index2 %>%
count(page) %>%
group_by(page, decade) %>%
ungroup()
pageplacement <- index2 %>%
group_by(page, decade) %>%
count(page) %>%
ungroup()
pageplacement <- pageplacement %>%
mutate(pct =(n/sum(n)))
pageplacement$pct <-formattable::percent(pageplacement$pct, 1)
View(pageplacement)
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were 29% of 11,223 pages. Graphic by Rob Wells, 12/27/2023",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
#scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
index2 <- index2 %>%
mutate(page_one = ifelse(page > 1, FALSE, TRUE))
View(index2)
pageplacement <- index2 %>%
group_by(decade, page_one) %>%
summarise(n = sum(n)) %>%
mutate(percentage = round(n / sum(n) * 100, 1)) %>%
mutate(page = case_when(
str_detect(page_one, "TRUE") ~ "PageOne",
str_detect(page_one, "FALSE") ~ "Inside"))
pageplacement <- index2 %>%
mutate(page = case_when(
str_detect(page_one, "TRUE") ~ "PageOne",
str_detect(page_one, "FALSE") ~ "Inside"))
View(pageplacement)
pageplacement <- index2 %>%
mutate(page2 = case_when(
str_detect(page_one, "TRUE") ~ "PageOne",
str_detect(page_one, "FALSE") ~ "Inside")) %>%
group_by(page2, decade) %>%
count(page2) %>%
ungroup()
pageplacement <- pageplacement %>%
mutate(pct =(n/sum(n)))
pageplacement$pct <-formattable::percent(pageplacement$pct, 1)
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
#scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page2, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page2, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page2, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
# scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page2, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct)
library(ggplot2)
library(dplyr)
# Assuming `pageplacement` is your data frame and it has columns `decade`, `page2`, and `pct`
pageplacement %>%
top_n(10, pct) %>%
ggplot(aes(x = factor(decade), y = pct, fill = factor(page2))) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label = pct, y = pct), position = position_dodge(width = 0.9), vjust = -0.25) +
labs(
title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redacted), 6/26/2024",
y = "Pct of Pages",
x = "Decade"
) +
scale_fill_manual(values = c("Page 1" = "blue", "Inside" = "red"))
index2$decade <- paste0(substr(index2$year, 0, 3), "0")
pageplacement <- index2 %>%
# mutate(page = str_replace(page, "seq-", "")) %>%
group_by(page, decade) %>%
count(page) %>%
ungroup()
pageplacement <- pageplacement %>%
mutate(pct =(n/sum(n)))
pageplacement$pct <-formattable::percent(pageplacement$pct, 1)
pageplacement %>%
top_n(10,pct)
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none")
pageplacement %>%
top_n(10,pct)
pageplacement <- index2 %>%
# mutate(page = str_replace(page, "seq-", "")) %>%
group_by(page) %>%
count(page) %>%
ungroup()
pageplacement <- pageplacement %>%
mutate(pct =(n/sum(n)))
pageplacement$pct <-formattable::percent(pageplacement$pct, 1)
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
# scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page2, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
# scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were XX% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were 34% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
pageplacement %>%
top_n(10,pct) %>%
mutate(page = reorder(page, -pct)) %>%
ggplot(aes(x = page, y = pct, fill = pct)) +
geom_col(position = "dodge") +
theme(legend.position = "none") +
#scale_x_continuous(breaks=c(1:15)) +
scale_y_continuous(labels = scales::percent) +
geom_text(aes(label= pct, x= page, y= pct), hjust=.5, vjust=0) +
labs(title = "Page Placement, Lynching Coverage, 1789-1963",
subtitle = "Page Number Placement of Lynching Stories",
caption = "Page 1 stories were 34% of 11,2237 pages. Graphic by (redcated) , 6/26/2024",
y="Pct of Pages",
x="Page Number")
ggsave("../output_images_tables/Article_Images/Figure_8_page_placement_6_25_2024.png",device = "png",width=9,height=6, dpi=800)
library(tidyverse)
#install.packages("sampler")
library(sampler)
#install.packages("rio")
library(rio)
#install.packages("kableExtra")
#install.packages("formattable")
library(formattable)
library(kableExtra)
library(knitr)
library(here)
#metadata for 11,396 articles observed by coding team. 19% of all 60,042 entries in search
master_article_index_june_26_2024 <- read_csv("https://osf.io/download/fuh3m/?view_only=6c106acd6cb54f6f849e8c6f9098809f") %>%
as.data.frame()
#Index of 11,223 articles of text extracted from 60,000 lynching articles: 18.7% of all 60,042 search captured
index2 <- read_csv("https://osf.io/download/hzyw6/?view_only=6c106acd6cb54f6f849e8c6f9098809f") %>%
as.data.frame()
tolnay_beck <- read_csv("https://osf.io/download/vb8wa/?view_only=6c106acd6cb54f6f849e8c6f9098809f") %>%
as.data.frame()
tolnay_beck <- janitor::clean_names(tolnay_beck)
# This contains
# tolnay_beck	5871 confirmed and probable
lynching_year <- master_article_index_june_26_2024 %>%
group_by(year) %>%
count(year) %>%
rename(total = n) %>%
mutate(pct_total = formattable::percent(total/11396, 3))
lynching_year
combo2 <- lynching_year %>%
right_join(tolnay_beck_year, by="year") %>%
filter(year <="1963")
tolnay_beck_year <- tolnay_beck %>%
group_by(year) %>%
count(year) %>%
rename(total = n) %>%
mutate(pct_total = formattable::percent(total/5871, 3))
tolnay_beck_year
combo2 <- lynching_year %>%
right_join(tolnay_beck_year, by="year") %>%
filter(year <="1963")
combo2 <- combo2 %>%
rename(news_total = total.x, news_pct = pct_total.x, lynch_total = total.y, lynch_pct = pct_total.y) %>%
mutate(gap = news_pct - lynch_pct) %>%
mutate(ratio = news_total/lynch_total)
#plot it
pl <- ggplot(data = combo2, aes(x = year))
pl <- pl + geom_line(aes(y=lynch_pct), colour = "blue")
pl <- pl + geom_line(aes(y=news_pct), colour = "red")
pl <- pl + scale_y_continuous(labels = scales::percent)
pl <- pl + scale_x_continuous(breaks=c(1860, 1865, 1870, 1875, 1880, 1885, 1890, 1895, 1900, 1905, 1910, 1915, 1920, 1925, 1930, 1935, 1940, 1945, 1950, 1955, 1960))
pl <- pl + theme(axis.text.x = element_text(angle=90))
pl <- pl + labs(x = "Year", y = "Pct of whole")
pl <- pl + labs(title = "Newspaper Coverage vs Lynchings, 1865-1963",
subtitle = "Newspaper Articles (Red) vs. Actual Victims (Blue), pct of whole",
caption = "Tolnay_Beck Victims n = 5871. Media n = 11,396 articles. Graphic by (redacted - peer review), 6/26/2024")
ggsave("../output_images_tables/Article_Images/Figure_5_ida_graph_6_26_2024.png", device = "png",width=9,height=6, dpi=800)
pl
View(combo2)
write.csv(combo2, "../output_images_tables/news_lynching_combo2_june27_2024.csv")
